{% trans_default_domain 'cocorico_listing' %}

{% include 'CocoricoCoreBundle:Frontend/Common:_flash.html.twig' %}

{{ form_start(form, {'attr': {'class': 'form-category'}}) }}

{{ form_errors(form) }}

{% include '@CocoricoCore/Frontend/Home/form_search_fields.html.twig' with {
    'form': form
} only %}

{{ form_end(form) }}

<script>
    document.getElementById("categories").removeAttribute("multiple");

    function setCookie(){
        var address = document.getElementById('location').value;
        var lat = document.getElementById('location_lat').value;
        var lng = document.getElementById('location_lng').value;
        var viewport = document.getElementById('location_viewport').value;
        var country = document.getElementById('location_country').value;
        var area = document.getElementById('location_area').value;
        var department = document.getElementById('location_department').value;
        var city  = document.getElementById('location_city').value;
        var zip = document.getElementById('location_zip').value;
        var route = document.getElementById('location_route').value;
        var streetNumber = document.getElementById('location_streetNumber').value;
        var addressType = document.getElementById('location_addressType').value;
        document.cookie = "address="+address;
        document.cookie = "lat="+lat;
        document.cookie = "lng="+lng;
        document.cookie = "viewport="+viewport;
        document.cookie = "country="+country;
        document.cookie = "area="+area;
        document.cookie = "department="+department;
        document.cookie = "city="+city;
        document.cookie = "zip="+zip;
        document.cookie = "route="+route;
        document.cookie = "streetNumber="+streetNumber;
        document.cookie = "addressType="+addressType;
    }

    document.getElementById("search").onclick = function(e){
        e.preventDefault();
        var location = document.getElementById("location").value;
        const index = location.lastIndexOf(",");
        if(index !== -1){
            location = location.slice(0,index);
        }
        location = location.replace(/\, /g,"-");           //replaces all occurrence of ', ' by '-'
        location = location.replace(" ","-");
        location = location.toLowerCase();
        const category_id = document.getElementById("categories").value;
        if(category_id){
            const category = document.getElementsByTagName("option");
            var i =0;
            var category_name = '';
            while(i < category.length){
                const value = category[i].getAttribute('value');
                if( value === category_id){
                    category_name  = category[i].innerHTML.trim();
                    break;
                }
                i++;
            }

            const index = category_name.lastIndexOf("/");
            if(index !== -1){
                category_name = category_name.slice(0,index);
            } else{
                const ind = category_name.lastIndexOf(" ");
                if (ind !== -1){
                    category_name = category_name.slice(0,ind);
                }
            }
            category_name = category_name.replace("/","-").trim();
            category_name = category_name.replace(" ","-");
            category_name = category_name.toLowerCase();
            if (category_name === 'live'){category_name = 'band'}
            else if (category_name === 'photo'){category_name = 'photographer'}
            else if (category_name === 'variety'){category_name = 'variety-artist'}
            else if (category_name === 'make-up-artist'){category_name = 'makeup-artist'}
            if (location){
                setCookie();
                window.open("/book-"+category_name+"-online/"+location,"_self");
            } else{
                setCookie();
                window.open("/book-"+category_name+"-online","_self");
            }
        } else{
            alert("Please select a category to search for.");
        }
    }
</script>